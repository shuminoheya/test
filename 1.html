<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>現在位置の行政区域名（国土地理院）</title>
</head>
<body>
  <h1>現在位置の行政区域名</h1>
  <button onclick="getLocation()">現在位置を取得</button>
  <p>緯度: <span id="lat">-</span></p>
  <p>経度: <span id="lng">-</span></p>
  <p>住所: <span id="address">-</span></p>
  <p id="status" style="color:red;"></p>

  <script>
    async function getLocation() {
      const latSpan = document.getElementById('lat');
      const lngSpan = document.getElementById('lng');
      const addrSpan = document.getElementById('address');
      const status = document.getElementById('status');

      status.textContent = '現在位置取得中…';
      addrSpan.textContent = '-';

      if (!navigator.geolocation) {
        status.textContent = 'この端末では位置情報が利用できません。';
        return;
      }

      navigator.geolocation.getCurrentPosition(
        async (pos) => {
          const lat = pos.coords.latitude;
          const lng = pos.coords.longitude;

          latSpan.textContent = lat.toFixed(6);
          lngSpan.textContent = lng.toFixed(6);

          try {
            const url = `https://mreversegeocoder.gsi.go.jp/reverse-geocoder/LonLatToAddress?lat=${lat}&lon=${lng}`;
            const res = await fetch(url);
            if (!res.ok) throw new Error('APIリクエスト失敗');

            const data = await res.json();
            const address = data.results.pref + data.results.city + data.results.town;
            addrSpan.textContent = address;
            status.textContent = '';
          } catch (e) {
            console.error(e);
            addrSpan.textContent = '住所取得エラー';
            status.textContent = '住所の取得に失敗しました。';
          }
        },
        () => {
          status.textContent = '位置情報の取得に失敗しました。';
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    }
  </script>
</body>
</html>
