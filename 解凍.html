<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>RAR / LZH / 7z → ZIP 変換（iPad対応）</title>

  <!-- ZIP 作成用 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <!-- RAR 解凍用 -->
  <script src="https://cdn.jsdelivr.net/npm/unrar-js@0.2.19/dist/unrar.min.js"></script>

  <!-- LZH 解凍用 -->
  <script src="https://cdn.jsdelivr.net/npm/lha@1.0.0/lha.min.js"></script>

  <!-- 7z 解凍用（JS版） -->
  <script src="https://cdn.jsdelivr.net/npm/7zdec@1.0.0/7zdec.min.js"></script>

</head>
<body>
  <h2>RAR / LZH / 7z → ZIP 変換（iPad対応）</h2>

  <input type="file" id="file" accept=".rar,.lzh,.7z">
  <button onclick="convert()">ZIP に変換</button>

  <script>
    async function convert() {
      const file = document.getElementById("file").files[0];
      if (!file) return alert("ファイルを選択してください");

      const arrayBuffer = await file.arrayBuffer();
      const zip = new JSZip();
      const name = file.name.toLowerCase();

      // --- RAR ---
      if (name.endsWith(".rar")) {
        const extractor = await unrar.createExtractorFromData({ data: arrayBuffer });
        const list = extractor.getFileList().fileHeaders;

        for (const header of list) {
          const extracted = extractor.extractFiles([header.name]);
          const fileData = extracted.files[header.name].extract[0].fileData;
          zip.file(header.name, fileData);
        }
      }

      // --- LZH ---
      else if (name.endsWith(".lzh")) {
        const files = LHA.decompress(arrayBuffer);
        files.forEach(f => {
          zip.file(f.filename, f.data);
        });
      }

      // --- 7z ---
      else if (name.endsWith(".7z")) {
        const archive = new SevenZip(arrayBuffer);
        const entries = archive.getEntries();

        for (const entry of entries) {
          if (!entry.isDirectory) {
            const data = archive.readFile(entry);
            zip.file(entry.name, data);
          }
        }
      }

      // ZIP を生成してダウンロード
      const zipBlob = await zip.generateAsync({ type: "blob" });
      const url = URL.createObjectURL(zipBlob);

      const a = document.createElement("a");
      a.href = url;
      a.download = file.name.replace(/\.(rar|lzh|7z)$/i, ".zip");
      a.click();
    }
  </script>
</body>
</html>
